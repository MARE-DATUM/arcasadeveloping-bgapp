# BGAPP ‚Äî Plataforma Cient√≠fica para Biodiversidade Marinha de Angola üá¶üá¥

Este reposit√≥rio cont√©m a implementa√ß√£o de uma plataforma Python especializada para investiga√ß√£o cient√≠fica da **Zona Econ√¥mica Especial Mar√≠tima de Angola**. O sistema integra dados ambientais, biodiversidade e telemetria, suportando an√°lises de biomassa, migra√ß√£o e ordenamento espacial com OGC APIs, STAC e integra√ß√£o com QGIS.

## üåä Caracter√≠sticas Espec√≠ficas para Angola

- **Zona Econ√¥mica Exclusiva:** Configurada para 518.000 km¬≤ da ZEE angolana
- **Esp√©cies Nativas:** Cat√°logo de 35+ esp√©cies marinhas da costa angolana
- **Correntes Regionais:** Modelos das correntes de Benguela e Angola
- **Dados Pesqueiros:** Integra√ß√£o com estat√≠sticas nacionais de pesca
- **Interface M√≥vel:** Otimizada para trabalho de campo em embarca√ß√µes
- **Modo Offline:** Coleta de dados em √°reas remotas com sincroniza√ß√£o posterior

## Requisitos
- Python 3.11+
- Docker e Docker Compose
- (Opcional) `uv` ou `poetry` para gest√£o de depend√™ncias

## Arranque r√°pido
1. Copiar vari√°veis de ambiente:
   ```bash
   cp example.env .env
   ```
2. Subir a stack m√≠nima:
   ```bash
   docker compose -f infra/docker-compose.yml up -d
   ```
3. Editar `configs/aoi.geojson` e `configs/variables.yaml` de acordo com a sua AOI e produtos.
4. (Opcional) Instalar depend√™ncias para executar conectores localmente:
   ```bash
   pip install -e .[dev,ingest,geo,orchestration]
   ```

## Estrutura
```
src/
  core/            # settings/utilit√°rios
  ingest/          # conectores (CMEMS, MODIS, OBIS/GBIF, ERDDAP, etc.)
  process/         # processamento raster/cubos e m√©tricas
  api/             # (futuro) processos pygeoapi
infra/
  docker-compose.yml
  pygeoapi/pygeoapi-config.yml
  pygeoapi/localdata/{aoi.geojson,occurrences.geojson,mcda.geojson}
  frontend/{index.html,dashboard.html}
configs/
  aoi.geojson
  variables.yaml   # crs: EPSG:4326
  species.yaml
scripts/
  fetch_obis_demo.py
  collect_metrics.py
  backup_minio.sh
notebooks/
dags/
  prefect_flow_demo.py
```

## üöÄ Servi√ßos e URLs

### Servi√ßos Backend
- **PostGIS:** `localhost:5432` (Base de dados espacial)
- **MinIO:** `http://localhost:9000` (Armazenamento de objectos, console: `:9001`)
- **STAC FastAPI:** `http://localhost:8081` (Cat√°logo de dados)
- **pygeoapi:** `http://localhost:5080` (APIs OGC abertas)
- **pygeoapi (protegido):** `http://localhost:8086` (login: demo/demo)
- **STAC Browser:** `http://localhost:8082` (Navegador de cat√°logo)
- **Keycloak:** `http://localhost:8083` (Autentica√ß√£o, admin: admin/admin)
- **Admin API:** `http://localhost:8000` (API administrativa para gest√£o do sistema)

### Interfaces de Utilizador
- **‚öôÔ∏è Painel Administrativo:** `http://localhost:8085/admin.html` *(ATUALIZADO - v2.1)*
  - üéØ **Acesso direto** a todas as p√°ginas e servi√ßos BGAPP
  - üìä **Monitoriza√ß√£o em tempo real** do sistema
  - üîß **Gest√£o completa** de servi√ßos (PostGIS, MinIO, STAC, etc.)
  - üì• **Controlo de ingest√£o** com 9 conectores incluindo **CDSE Sentinel**
  - ‚öôÔ∏è **Configura√ß√£o** de AOI, esp√©cies e vari√°veis
  - üë• **Gest√£o de utilizadores** e seguran√ßa
  - üìù **Logs do sistema** e backup/restore
  - üöÄ **Performance otimizada** com arquitetura modular
  - üÜï **Novo conector Sentinel** via openEO para NDVI e bandas espectrais
- **üñ•Ô∏è Dashboard Cient√≠fico:** `http://localhost:8085/dashboard.html`
  - √çndices de biodiversidade (Shannon, Simpson, Margalef)
  - Gr√°ficos temporais e distribui√ß√£o taxon√¥mica
  - Filtros cient√≠ficos avan√ßados
  - Exporta√ß√£o de dados (CSV, GeoJSON, NetCDF)
- **üì± Interface Mobile:** `http://localhost:8085/mobile.html`
  - Coleta de dados em campo
  - GPS integrado e modo offline
  - Sincroniza√ß√£o autom√°tica
- **üó∫Ô∏è Mapa Interativo:** `http://localhost:8085` (Visualiza√ß√£o b√°sica)

### üá¶üá¥ Cole√ß√µes de Dados Angolanas
- `collections/aoi` ‚Äî Zona Econ√¥mica Exclusiva de Angola
- `collections/occurrences` ‚Äî Fauna marinha angolana (35+ esp√©cies)
- `collections/fisheries` ‚Äî Dados pesqueiros por zona (Norte/Centro/Sul)
- `collections/oceanography` ‚Äî Correntes de Benguela e Angola
- `collections/mcda` ‚Äî Mapas de adequa√ß√£o para conserva√ß√£o/pesca

## Makefile (atalhos)
```bash
make up | make ps | make down
make collections
make demo-data           # SPECIES/START/END opcionais
make metrics             # grava logs/metrics.jsonl
make backup              # backup local (pygeoapi/localdata)
```

## üß™ Testes e Valida√ß√£o
```bash
# Testar integridade do painel administrativo
python scripts/test_admin_panel.py

# Iniciar painel administrativo automaticamente
python scripts/start_admin.py

# Verificar m√©tricas do sistema
python scripts/collect_metrics.py
```

## üåê Acesso Remoto Seguro
```bash
# OP√á√ÉO 1: ngrok (Mais f√°cil - recomendado)
python scripts/setup_ngrok_tunnel.py

# OP√á√ÉO 2: Cloudflare Tunnel (M√°xima seguran√ßa)
python scripts/setup_secure_access.py

# OP√á√ÉO 3: T√∫nel SSH (Se tens servidor)
python scripts/setup_ssh_tunnel.py
```

**Guia completo**: [docs/REMOTE_ACCESS_GUIDE.md](docs/REMOTE_ACCESS_GUIDE.md)

## Orquestra√ß√£o e CRS
- Orquestra√ß√£o de refer√™ncia: Prefect 2.x (leve). Exemplo:
  ```bash
  python dags/prefect_flow_demo.py
  ```
- CRS padr√£o: EPSG:4326 (WGS84). Reproje√ß√µes para CRS locais (ex.: ETRS89 / PT-TM06) apenas quando necess√°rio.

## Guia QGIS (OGC API Features)
1. Abrir QGIS ‚Üí Data Source Manager ‚Üí OGC API - Features
2. URL: `http://localhost:5080` ‚Üí Conectar ‚Üí Selecionar `aoi`, `occurrences` e `mcda`
3. Adicionar camadas ao projeto. Estiliza√ß√£o:
   - `occurrences`: simbologia de pontos (vermelho, 3‚Äì4 px)
   - `mcda`: renderizador categorizado por `class` (alta/m√©dia/baixa)
4. Guardar projeto para refer√™ncia.

## Licen√ßas, ToU e Anonimiza√ß√£o
- Copernicus (CDSE/CMEMS/CDS): dados abertos; citar fontes e termos.
- GBIF/OBIS: licen√ßas por dataset (CC-BY/CC0). Citar DOI/origem.
- Movebank: muitos estudos requerem permiss√£o expl√≠cita. Cumprir Data Use Terms.
- eBird: requer API key; limites/ToU. Dados completos via EBD sob pedido.
- Anonimiza√ß√£o: para esp√©cies sens√≠veis, aplique deslocamento/agrega√ß√£o espacial (ex.: jitter >1 km ou hex bins), supress√£o de locais de nidifica√ß√£o/amea√ßados e janelas temporais agregadas (ex.: mensal).
- Governa√ß√£o: mantenha metadados de origem, datas de extra√ß√£o e vers√£o; registe hashes dos ficheiros (ver `scripts/collect_metrics.py` para logging de base; expandir para hashing).

## üß™ Exemplos de Uso para Angola

### Coleta de Dados Marinhos
```bash
# Dados de fauna marinha angolana (OBIS)
python -m src.bgapp.ingest.obis --taxonid 141438 --start 2024-06-01 --end 2024-06-30 \
  --aoi configs/aoi.geojson --out infra/pygeoapi/localdata/occurrences.geojson

# Dados pesqueiros da zona centro de Angola
python -m src.bgapp.ingest.fisheries_angola --type catch --zone zona_centro \
  --start 2024-01-01 --end 2024-12-31 --format geojson

# Dados oceanogr√°ficos regionais (Correntes de Benguela/Angola)
python -m src.bgapp.models.angola_oceanography --generate-grid --resolution 0.25 \
  --months 6,7,8,9 --out oceanography_angola.json

# Fontes de dados angolanas (INIP, UAN, MINAGRIP)
python -m src.bgapp.ingest.angola_sources --source inip --type fisheries \
  --start 2024-01-01 --end 2024-12-31
```

### An√°lise e Relat√≥rios
```bash
# Gerar relat√≥rio cient√≠fico autom√°tico
python -m src.bgapp.reports.angola_marine_report data/observations.json \
  --output relatorio_biodiversidade_angola

# Sincroniza√ß√£o offline (para trabalho de campo)
python -m src.bgapp.offline.sync_manager --sync-all --export backup_campo.geojson

# Clorofila-a CMEMS (requer conta Copernicus Marine)
python -m src.bgapp.ingest.cmems_chla --start 2024-06-01 --end 2024-06-30 \
  --bbox 11.4,-18.5,16.8,-4.4  # ZEE Angola
```

## Desenvolvimento
- Linters: `ruff` e `mypy` configurados em `pyproject.toml`.
- Pre-commit:
  ```bash
  pip install pre-commit
  pre-commit install
  pre-commit run --all-files
  ```


