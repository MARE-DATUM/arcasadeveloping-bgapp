'use client';

import { useEffect } from 'react';
import { useMap } from 'react-leaflet';
import L from 'leaflet';

interface AngolaCoastlineProps {
  visible: boolean;
  showZEE?: boolean;
  showMainland?: boolean;
  showCabinda?: boolean;
  showTerritorialSea?: boolean;
}

export function AngolaCoastline({
  visible,
  showZEE = true,
  showMainland = true,
  showCabinda = true,
  showTerritorialSea = false
}: AngolaCoastlineProps) {
  const map = useMap();

  useEffect(() => {
    if (!map || !visible) return;

    const layers: L.Layer[] = [];

    // Ocean area fill (added first so it appears behind other layers)
    const oceanAreaCoordinates: [number, number][] = [
      [-4.0, 7.0],   // Northwest
      [-4.0, 15.0],  // Northeast
      [-19.0, 15.0], // Southeast
      [-19.0, 7.0],  // Southwest
      [-4.0, 7.0]    // Close polygon
    ];

    const oceanArea = L.polygon(oceanAreaCoordinates, {
      color: 'transparent',
      weight: 0,
      fillColor: '#1e40af',
      fillOpacity: 0.05,
      interactive: false
    });

    oceanArea.addTo(map);
    layers.push(oceanArea);

    // Angola EEZ (Exclusive Economic Zone) - Official boundaries from Marine Regions
    if (showZEE) {
      // Mainland Angola EEZ - Official from angola_eez.json (MRGID 8478)
      // Simplified from 14,662 to 295 points for performance
      if (showMainland) {
        const angolaMainlandEEZ: [number, number][] = [
          [-5.87339592, 13.42086184],
          [-5.87746477, 13.26327336],
          [-5.93624985, 12.96152461],
          [-6.04894233, 12.65482163],
          [-6.09452915, 12.59745884],
          [-6.13880825, 12.60900462],
          [-6.10689473, 12.40558577],
          [-6.14583194, 12.39440703],
          [-6.14771581, 12.34338868],
          [-6.12199461, 12.30860186],
          [-6.32435524, 12.39537823],
          [-6.87007511, 12.75006294],
          [-7.20703125, 12.85071945],
          [-7.54519773, 12.98471618],
          [-7.734375, 13.05904102],
          [-7.84047377, 13.14326334],
          [-7.94433916, 13.15022135],
          [-8.15220547, 13.26517332],
          [-8.47056913, 13.37810874],
          [-8.6745826, 13.41628218],
          [-8.81060266, 13.23435974],
          [-8.80818117, 13.22156906],
          [-9.01470387, 13.07285237],
          [-9.06901038, 13.00456572],
          [-9.16718245, 13.04206646],
          [-9.29275966, 13.19190037],
          [-9.20172977, 13.23827815],
          [-9.37872434, 13.16217268],
          [-9.67044616, 13.21794796],
          [-9.97814596, 13.31084132],
          [-10.23661137, 13.49631548],
          [-10.51086795, 13.64470124],
          [-10.78303492, 13.73688686],
          [-11.30152392, 13.82932365],
          [-11.49905574, 13.78463066],
          [-11.79199457, 13.79411018],
          [-12.12753117, 13.69606304],
          [-12.33496428, 13.56159794],
          [-12.60491073, 13.359375],
          [-12.59898305, 13.20179236],
          [-12.8866688, 12.94576848],
          [-13.05006206, 12.9093008],
          [-13.22742546, 12.73772788],
          [-13.32434201, 12.64789188],
          [-13.45234966, 12.53118277],
          [-13.58491766, 12.54754782],
          [-13.70485485, 12.53230071],
          [-13.84424543, 12.52747476],
          [-13.87662125, 12.42415667],
          [-14.12137961, 12.36074984],
          [-14.39690316, 12.35340095],
          [-14.57533467, 12.3046875],
          [-14.73573196, 12.28137934],
          [-14.95228171, 12.19005334],
          [-15.1968739, 12.14077246],
          [-15.42962444, 12.02973986],
          [-15.73817146, 11.91129828],
          [-15.78173447, 11.78141677],
          [-16.29372776, 11.81027174],
          [-16.65190124, 11.82284975],
          [-16.79105544, 11.80669951],
          [-17.01346564, 11.75525653],
          [-17.27136228, 11.78902656],
          [-17.2691383, 11.78559301],
          [-17.26624782, 11.78194187],
          [-17.26394231, 11.77832731],
          [-17.26006412, 11.77584891],
          [-17.25656136, 11.77151686],
          [-17.25345736, 11.76801946],
          [-17.25098633, 11.76321291],
          [-17.24769528, 11.75994397],
          [-17.24493839, 11.75646675],
          [-17.24296301, 11.75211397],
          [-17.25, 8.31566605],
          [-17.08347556, 8.23402337],
          [-16.90624931, 8.21201729],
          [-16.71485988, 8.19858387],
          [-16.49143057, 8.19713613],
          [-16.20216412, 8.21822686],
          [-15.99753562, 8.24846989],
          [-15.8391167, 8.2706603],
          [-15.63008111, 8.28215762],
          [-15.4695898, 8.2999414],
          [-15.26504504, 8.33418377],
          [-15.03661298, 8.38860076],
          [-14.71062075, 8.49522135],
          [-14.52739764, 8.56958978],
          [-14.32390874, 8.66704868],
          [-14.11646768, 8.78344125],
          [-13.86209992, 8.9166339],
          [-13.64054703, 8.94795445],
          [-13.48068754, 8.98020592],
          [-13.21145388, 9.04716122],
          [-12.92698753, 9.13913132],
          [-12.76398028, 9.17594629],
          [-12.54267675, 9.23285221],
          [-12.33360268, 9.29997279],
          [-12.1407433, 9.37529046],
          [-11.9194673, 9.47928724],
          [-11.7226459, 9.58903023],
          [-11.54602886, 9.70302231],
          [-11.35785156, 9.8397121],
          [-11.17436584, 9.97728657],
          [-11.05262676, 10.05840812],
          [-10.82732515, 10.01400405],
          [-10.67405998, 9.96320074],
          [-10.49583837, 9.91410252],
          [-10.30924238, 9.84653458],
          [-10.21415985, 9.81146883],
          [-10.06714674, 9.76365111],
          [-9.88718192, 9.71513993],
          [-9.7557249, 9.68634666],
          [-9.57695375, 9.65546955],
          [-9.37826441, 9.63279971],
          [-9.18178463, 9.62218658],
          [-9.05288594, 9.62116071],
          [-8.88666392, 9.62697185],
          [-8.57607963, 9.65874694],
          [-8.40704793, 9.68740495],
          [-8.24558378, 9.6023452],
          [-8.06861148, 9.51457244],
          [-7.84667274, 9.3829247],
          [-7.63847904, 9.27118329],
          [-7.43352747, 9.17896104],
          [-7.25667458, 9.1122557],
          [-6.06976345, 12.40249964],
          [-6.07870012, 12.42740317],
          [-6.08080502, 12.43846082],
          [-6.08052752, 12.44529117],
          [-6.07754891, 12.45568763],
          [-6.07674513, 12.46009573],
          [-6.07594135, 12.46450383],
          [-6.07510733, 12.46908853],
          [-6.07431612, 12.4744029],
          [-6.07194557, 12.48436107],
          [-6.06941829, 12.49167679],
          [-6.06730411, 12.49643803],
          [-6.0626901, 12.50787804],
          [-6.05876456, 12.52205111],
          [-6.05730405, 12.52747134],
          [-6.05539909, 12.53403127],
          [-6.05050252, 12.54553686],
          [-6.04922146, 12.54980723],
          [-6.04761968, 12.55569971],
          [-6.04284948, 12.56792318],
          [-6.03757182, 12.58193424],
          [-6.03613237, 12.59150246],
          [-6.03176622, 12.59872276],
          [-6.02619823, 12.60778659],
          [-6.02421143, 12.61170747],
          [-6.02195875, 12.6161051],
          [-6.01840513, 12.62361184],
          [-6.01702217, 12.63010033],
          [-6.02117687, 12.64004356],
          [-6.01960147, 12.65234272],
          [-6.01526636, 12.66074824],
          [-6.00831364, 12.66795183],
          [-6.00762342, 12.67512936],
          [-6.00727317, 12.67956861],
          [-6.00678978, 12.68416872],
          [-6.00624854, 12.69095459],
          [-6.00791609, 12.69893224],
          [-6.00501466, 12.70816232],
          [-6.00008637, 12.71757392],
          [-5.99356699, 12.72265],
          [-5.98512343, 12.72924072],
          [-5.98167625, 12.73191082],
          [-5.977143, 12.7363569],
          [-5.97140748, 12.7458041],
          [-5.97108263, 12.7502105],
          [-5.97099806, 12.75630817],
          [-5.97083496, 12.76185164],
          [-5.97055587, 12.76718715],
          [-5.9718332, 12.7728876],
          [-5.97301762, 12.77911017],
          [-5.97772973, 12.78849191],
          [-5.97668945, 12.79948599],
          [-5.97520528, 12.80924541],
          [-5.97328228, 12.81460881],
          [-5.96549147, 12.81835668],
          [-5.96051984, 12.82352772],
          [-5.95641297, 12.82795073],
          [-5.95007759, 12.83325082],
          [-5.94510655, 12.83683263],
          [-5.94014133, 12.84037994],
          [-5.94059624, 12.84982421],
          [-5.94350837, 12.85547584],
          [-5.94529527, 12.8624877],
          [-5.94761037, 12.87068813],
          [-5.94492958, 12.87614922],
          [-5.94280978, 12.8802427],
          [-5.94029944, 12.88572626],
          [-5.9363162, 12.89095124],
          [-5.93261971, 12.89471837],
          [-5.92617603, 12.90190882],
          [-5.91887754, 12.90812748],
          [-5.91794595, 12.91851131],
          [-5.91761308, 12.93142572],
          [-5.91957855, 12.94004879],
          [-5.91724455, 12.94763603],
          [-5.91377307, 12.95144323],
          [-5.90859202, 12.95986439],
          [-5.90719149, 12.9659842],
          [-5.90443067, 12.97040504],
          [-5.90210646, 12.97534057],
          [-5.89768396, 12.98312564],
          [-5.89482084, 12.99117194],
          [-5.89178013, 12.9964041],
          [-5.88824416, 13.0031922],
          [-5.8786485, 13.00795946],
          [-5.87103771, 13.01707694],
          [-5.86971325, 13.02331411],
          [-5.8674227, 13.03104053],
          [-5.86513759, 13.03624572],
          [-5.86402809, 13.04122787],
          [-5.86381322, 13.04672017],
          [-5.86426724, 13.05295947],
          [-5.86541049, 13.0586001],
          [-5.86667881, 13.06256693],
          [-5.86836581, 13.06727064],
          [-5.86961278, 13.0728675],
          [-5.87150933, 13.07980896],
          [-5.87156685, 13.08415244],
          [-5.87260336, 13.08829361],
          [-5.87525191, 13.09304837],
          [-5.87985855, 13.09723643],
          [-5.88518825, 13.09891528],
          [-5.89345098, 13.1039646],
          [-5.89639824, 13.10709831],
          [-5.90168513, 13.11118737],
          [-5.90457461, 13.11470585],
          [-5.9032224, 13.12041906],
          [-5.89933861, 13.12794216],
          [-5.8976748, 13.1322172],
          [-5.89560914, 13.13731264],
          [-5.88995879, 13.14169349],
          [-5.88666913, 13.14555093],
          [-5.88365198, 13.150278],
          [-5.88214988, 13.15430104],
          [-5.88055284, 13.15846226],
          [-5.8787358, 13.16242086],
          [-5.87686918, 13.16648718],
          [-5.87531903, 13.17127502],
          [-5.87543126, 13.17693289],
          [-5.87353635, 13.18231234],
          [-5.87276853, 13.1880754],
          [-5.87138641, 13.19231624],
          [-5.86928702, 13.197324],
          [-5.86607096, 13.20353831],
          [-5.86539342, 13.20794918],
          [-5.86379402, 13.21351027],
          [-5.86298582, 13.21785951],
          [-5.86197034, 13.2228471],
          [-5.86378012, 13.2288547],
          [-5.86574014, 13.23312364],
          [-5.8655572, 13.23844122],
          [-5.86533252, 13.24290794],
          [-5.86569593, 13.24737223],
          [-5.86646572, 13.25167898],
          [-5.86892135, 13.25729257],
          [-5.87057879, 13.26429961],
          [-5.87292113, 13.26793234],
          [-5.87478301, 13.27337355],
          [-5.87568043, 13.28109433],
          [-5.87762953, 13.28586731],
          [-5.87904077, 13.28996797],
          [-5.88086014, 13.29406824],
          [-5.88425787, 13.29907707],
          [-5.88921311, 13.30278647],
          [-5.8923616, 13.30572147],
          [-5.894511, 13.31189454],
          [-5.89488997, 13.31707715],
          [-5.89615397, 13.32649282],
          [-5.90258497, 13.34158859],
          [-5.90470753, 13.34735261],
          [-5.90931216, 13.35413731],
          [-5.90779355, 13.36081489],
          [-5.90158522, 13.36522262],
          [-5.89504004, 13.36727672],
          [-5.89107412, 13.36947788],
          [-5.8868642, 13.37091645],
          [-5.88259085, 13.37237613],
          [-5.87859046, 13.37404677],
          [-5.87403116, 13.37693719],
          [-5.87044459, 13.38177652],
          [-5.87041982, 13.38782225],
          [-5.87306985, 13.39612601],
          [-5.87253359, 13.40326275],
          [-5.87121467, 13.40750359],
          [-5.87045807, 13.41193276],
          [-5.86970148, 13.41636193],
          [-5.8682879, 13.42115821],
          [-5.86647835, 13.42498493],
          [-5.86018032, 13.42860734],
          [-5.87339592, 13.42086184]
        ];

        const mainlandEEZ = L.polygon(angolaMainlandEEZ, {
          color: '#2563eb',
          weight: 2,
          fillColor: '#3b82f6',
          fillOpacity: 0.15,
          dashArray: '5, 5'
        }).bindPopup(`
          <div style="padding: 8px;">
            <strong>Angola Mainland EEZ</strong><br/>
            Type: Exclusive Economic Zone (200NM)<br/>
            Area: ~518,598 kmÂ²<br/>
            Source: Marine Regions (angola_eez.json)
          </div>
        `);

        mainlandEEZ.addTo(map);
        layers.push(mainlandEEZ);
      }

      // Cabinda EEZ - Official from angola_eez.json (MRGID 8478)
      // Simplified from 190 to 39 points for performance
      if (showCabinda) {
        const cabindaEEZ: [number, number][] = [
          [-5.03405595, 12.01522934],
          [-5.09765625, 12.05873382],
          [-5.18259525, 12.11891007],
          [-5.18202996, 12.11917925],
          [-5.17136657, 12.11540806],
          [-5.16309094, 12.10778356],
          [-5.15876114, 12.11321902],
          [-5.16249132, 12.11863363],
          [-5.16247904, 12.12553191],
          [-5.16489947, 12.12862611],
          [-5.17435634, 12.13432026],
          [-5.17360175, 12.13637686],
          [-5.18328643, 12.13937581],
          [-5.19543374, 12.13860786],
          [-5.19891822, 12.13297725],
          [-5.19444084, 12.13317442],
          [-5.19492137, 12.13089073],
          [-5.20464003, 12.13532746],
          [-5.22969806, 12.13618135],
          [-5.26604354, 12.14952552],
          [-5.30759382, 12.17387307],
          [-5.32777274, 12.17741263],
          [-5.347247, 12.17673266],
          [-5.44921875, 12.21672678],
          [-5.4950242, 12.23013234],
          [-5.54508305, 12.2295233],
          [-5.55796325, 12.21071994],
          [-5.56367445, 12.17672861],
          [-5.60919845, 12.16149843],
          [-5.63744235, 12.14622414],
          [-5.69180286, 12.15462744],
          [-5.71969855, 12.16849256],
          [-5.73982227, 12.17708695],
          [-5.77304766, 12.20241335],
          [-5.99206942, 10.37926479],
          [-5.08729461, 11.91272323],
          [-5.03122561, 12.00775182],
          [-5.03014708, 12.00958014],
          [-5.03405595, 12.01522934]
        ];

        const cabindaPolygon = L.polygon(cabindaEEZ, {
          color: '#2563eb',
          weight: 2,
          fillColor: '#3b82f6',
          fillOpacity: 0.15,
          dashArray: '5, 5'
        }).bindPopup(`
          <div style="padding: 8px;">
            <strong>Cabinda Maritime Zone</strong><br/>
            Type: Exclusive Economic Zone (200NM)<br/>
            Province: Cabinda<br/>
            Source: Marine Regions (angola_eez.json)
          </div>
        `);

        cabindaPolygon.addTo(map);
        layers.push(cabindaPolygon);
      }
    }

    // Cleanup on component unmount
    return () => {
      layers.forEach(layer => {
        map.removeLayer(layer);
      });
    };
  }, [map, visible, showZEE, showMainland, showCabinda, showTerritorialSea]);

  return null;
}