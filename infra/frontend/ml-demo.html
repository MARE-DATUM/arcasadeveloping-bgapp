<!DOCTYPE html>
<html lang="pt">
<head>
    <!-- Favicon BGAPP -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <meta name="theme-color" content="#173c72">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BGAPP ML Demo - Machine Learning Integrado</title>
    
    <!-- CSS Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" rel="stylesheet">
    
    <!-- ML Components CSS -->
    <link rel="stylesheet" href="assets/css/ml-components.css?v=1.0.0">
    
    <!-- Leaflet -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .demo-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 2rem 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .demo-container {
            padding: 2rem 0;
        }
        
        .demo-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .demo-map {
            height: 500px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .feature-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .feature-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: #6f42c1;
        }
        
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-implemented {
            background: #28a745;
            color: white;
        }
        
        .status-demo {
            background: #17a2b8;
            color: white;
        }
        
        .btn-demo {
            background: linear-gradient(135deg, #6f42c1, #17a2b8);
            border: none;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-demo:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(111, 66, 193, 0.3);
            color: white;
        }
        
        .demo-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #6f42c1;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: #666;
            font-weight: 500;
        }
        
        .demo-log {
            background: #1a1a1a;
            color: #00ff00;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 1rem;
        }
        
        .demo-controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 2rem;
        }
        
        @media (max-width: 768px) {
            .demo-controls {
                flex-direction: column;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
            }
            
            .demo-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="demo-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="h2 mb-2">üß† BGAPP Machine Learning Demo</h1>
                    <p class="lead mb-0">Demonstra√ß√£o das funcionalidades de IA integradas ao frontend</p>
                </div>
                <div class="col-md-4 text-md-end">
                    <span class="status-badge status-implemented">Sistema Implementado</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container demo-container">
        
        <!-- Status Overview -->
        <div class="demo-section">
            <h3>üìä Status do Sistema</h3>
            <div class="demo-stats">
                <div class="stat-card">
                    <div class="stat-number" id="ml-service-status">üîÑ</div>
                    <div class="stat-label">MLService</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="models-count">-</div>
                    <div class="stat-label">Modelos Dispon√≠veis</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="filters-count">-</div>
                    <div class="stat-label">Filtros Ativos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="cache-hits">-</div>
                    <div class="stat-label">Cache Hit Rate</div>
                </div>
            </div>
        </div>

        <!-- Interactive Map Demo -->
        <div class="demo-section">
            <h3>üó∫Ô∏è Mapa com Overlays Preditivos</h3>
            <p>Mapa interativo com filtros de Machine Learning integrados. Os overlays mostram predi√ß√µes em tempo real baseadas nos modelos treinados.</p>
            
            <div class="demo-controls">
                <button class="btn btn-demo" onclick="demoMapFeatures()">
                    üöÄ Demonstrar Filtros ML
                </button>
                <button class="btn btn-demo" onclick="testPredictions()">
                    üîÆ Testar Predi√ß√µes
                </button>
                <button class="btn btn-demo" onclick="showMLStats()">
                    üìä Estat√≠sticas ML
                </button>
                <button class="btn btn-demo" onclick="clearDemoData()">
                    üßπ Limpar Demo
                </button>
            </div>
            
            <div id="demo-map" class="demo-map"></div>
        </div>

        <!-- Features Overview -->
        <div class="demo-section">
            <h3>üöÄ Funcionalidades Implementadas</h3>
            <div class="feature-grid">
                
                <div class="feature-card">
                    <div class="feature-icon">üì°</div>
                    <h5>MLService Layer</h5>
                    <p>Camada de comunica√ß√£o robusta com a API de ML, incluindo cache inteligente, retry autom√°tico e tratamento de erros.</p>
                    <span class="status-badge status-implemented">Implementado</span>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">üó∫Ô∏è</div>
                    <h5>Overlays Preditivos</h5>
                    <p>Sistema de camadas inteligentes no mapa que mostram predi√ß√µes de biodiversidade, zonas de pesca e √°reas de conserva√ß√£o.</p>
                    <span class="status-badge status-implemented">Implementado</span>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">üéõÔ∏è</div>
                    <h5>Painel de Controle ML</h5>
                    <p>Interface intuitiva para gerenciar filtros preditivos, com controles de visibilidade, atualiza√ß√£o e configura√ß√£o.</p>
                    <span class="status-badge status-implemented">Implementado</span>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">üîÆ</div>
                    <h5>Predi√ß√µes em Tempo Real</h5>
                    <p>Sistema que faz predi√ß√µes instant√¢neas baseadas na localiza√ß√£o do usu√°rio e par√¢metros ambientais.</p>
                    <span class="status-badge status-demo">Demo</span>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">üìä</div>
                    <h5>Widgets Inteligentes</h5>
                    <p>Componentes de dashboard que se adaptam automaticamente e mostram insights gerados por IA.</p>
                    <span class="status-badge status-demo">Demo</span>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">üì±</div>
                    <h5>Mobile ML Features</h5>
                    <p>Funcionalidades de reconhecimento de esp√©cies e coleta inteligente de dados para dispositivos m√≥veis.</p>
                    <span class="status-badge status-demo">Demo</span>
                </div>
                
            </div>
        </div>

        <!-- Technical Details -->
        <div class="demo-section">
            <h3>üîß Detalhes T√©cnicos</h3>
            <div class="row">
                <div class="col-md-6">
                    <h5>Arquitetura</h5>
                    <ul>
                        <li><strong>Frontend:</strong> JavaScript ES6+ com Leaflet.js</li>
                        <li><strong>Comunica√ß√£o:</strong> Fetch API com retry e cache</li>
                        <li><strong>Visualiza√ß√£o:</strong> GeoJSON com marcadores din√¢micos</li>
                        <li><strong>Performance:</strong> Cache hier√°rquico e lazy loading</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h5>Funcionalidades</h5>
                    <ul>
                        <li><strong>Cache Inteligente:</strong> TTL de 5 minutos com invalida√ß√£o autom√°tica</li>
                        <li><strong>Retry Logic:</strong> 3 tentativas com backoff exponencial</li>
                        <li><strong>Event System:</strong> Comunica√ß√£o entre componentes</li>
                        <li><strong>Responsive Design:</strong> Interface adaptativa para mobile</li>
                    </ul>
                </div>
            </div>
            
            <h5 class="mt-4">Log de Atividades</h5>
            <div id="demo-log" class="demo-log">
                <div>üöÄ Sistema de ML Demo inicializado...</div>
                <div>üì° Aguardando conex√£o com MLService...</div>
            </div>
        </div>

    </div>

    <!-- Scripts -->
    <script src="assets/js/ml-service.js?v=1.0.0"></script>
    <script src="assets/js/ml-map-overlays.js?v=1.0.0"></script>
    
    <script>
        // Demo Controller
        class MLDemo {
            constructor() {
                this.map = null;
                this.mlOverlays = null;
                this.logContainer = document.getElementById('demo-log');
                this.stats = {
                    predictions: 0,
                    cacheHits: 0,
                    totalRequests: 0
                };
            }

            async initialize() {
                this.log('üöÄ Inicializando ML Demo...');
                
                try {
                    // Inicializar mapa
                    await this.initializeMap();
                    
                    // Aguardar MLService
                    await this.waitForMLService();
                    
                    // Inicializar overlays
                    await this.initializeMLOverlays();
                    
                    // Configurar event listeners
                    this.setupEventListeners();
                    
                    // Atualizar estat√≠sticas
                    this.updateStats();
                    
                    this.log('‚úÖ ML Demo inicializado com sucesso!');
                    
                } catch (error) {
                    this.log(`‚ùå Erro na inicializa√ß√£o: ${error.message}`);
                }
            }

            async initializeMap() {
                this.log('üó∫Ô∏è Criando mapa...');
                
                this.map = L.map('demo-map', {
                    center: [-12.5, 13.5],
                    zoom: 6,
                    zoomControl: true
                });

                // Adicionar camada base
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors',
                    maxZoom: 19
                }).addTo(this.map);

                this.log('‚úÖ Mapa criado');
            }

            async waitForMLService() {
                this.log('üì° Aguardando MLService...');
                
                return new Promise((resolve) => {
                    const checkMLService = () => {
                        if (window.mlService && window.mlService.initialize) {
                            this.log('‚úÖ MLService dispon√≠vel');
                            resolve();
                        } else {
                            setTimeout(checkMLService, 500);
                        }
                    };
                    checkMLService();
                });
            }

            async initializeMLOverlays() {
                this.log('üß† Inicializando overlays ML...');
                
                if (window.MLMapOverlays) {
                    this.mlOverlays = new MLMapOverlays(this.map, window.mlService);
                    await this.mlOverlays.initialize();
                    this.log('‚úÖ Overlays ML inicializados');
                } else {
                    this.log('‚ö†Ô∏è MLMapOverlays n√£o dispon√≠vel');
                }
            }

            setupEventListeners() {
                // Escutar eventos do MLService
                if (window.mlService) {
                    window.mlService.on('initialized', (data) => {
                        this.log(`üß† MLService inicializado: ${data.models} modelos, ${data.filters} filtros`);
                        this.updateStats();
                    });

                    window.mlService.on('prediction', (data) => {
                        this.stats.predictions++;
                        this.log(`üîÆ Predi√ß√£o realizada: ${data.modelType} (confian√ßa: ${(data.result.confidence * 100).toFixed(1)}%)`);
                        this.updateStats();
                    });

                    window.mlService.on('error', (data) => {
                        this.log(`‚ùå Erro ML: ${data.error}`);
                    });
                }
            }

            async updateStats() {
                try {
                    // Status do MLService
                    const serviceStatus = window.mlService ? '‚úÖ' : '‚ùå';
                    document.getElementById('ml-service-status').textContent = serviceStatus;

                    if (window.mlService) {
                        // Modelos dispon√≠veis
                        try {
                            const models = await window.mlService.getModels();
                            document.getElementById('models-count').textContent = models.total || 0;
                        } catch (e) {
                            document.getElementById('models-count').textContent = 'N/A';
                        }

                        // Filtros ativos
                        try {
                            const filters = await window.mlService.getFilters();
                            document.getElementById('filters-count').textContent = filters.active || 0;
                        } catch (e) {
                            document.getElementById('filters-count').textContent = 'N/A';
                        }

                        // Cache stats
                        const cacheStats = window.mlService.getCacheStats();
                        const hitRate = (cacheStats.hitRate * 100).toFixed(1);
                        document.getElementById('cache-hits').textContent = `${hitRate}%`;
                    }
                } catch (error) {
                    this.log(`‚ö†Ô∏è Erro atualizando stats: ${error.message}`);
                }
            }

            log(message) {
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = document.createElement('div');
                logEntry.textContent = `[${timestamp}] ${message}`;
                this.logContainer.appendChild(logEntry);
                this.logContainer.scrollTop = this.logContainer.scrollHeight;
            }
        }

        // Fun√ß√µes de demonstra√ß√£o
        async function demoMapFeatures() {
            mlDemo.log('üöÄ Demonstrando filtros ML...');
            
            if (mlDemo.mlOverlays) {
                const stats = mlDemo.mlOverlays.getStats();
                mlDemo.log(`üìä Filtros dispon√≠veis: ${stats.totalFilters}`);
                mlDemo.log(`üëÅÔ∏è Filtros ativos: ${stats.activeFilters}`);
                mlDemo.log(`üìç Total de pontos: ${stats.totalPoints}`);
                
                // Simular ativa√ß√£o de filtros
                if (stats.totalFilters > 0) {
                    mlDemo.log('üéØ Ativando filtros automaticamente...');
                    // Aqui seria implementada a ativa√ß√£o autom√°tica
                }
            } else {
                mlDemo.log('‚ö†Ô∏è Overlays ML n√£o dispon√≠veis');
            }
        }

        async function testPredictions() {
            mlDemo.log('üîÆ Testando predi√ß√µes...');
            
            if (window.mlService) {
                try {
                    const center = mlDemo.map.getCenter();
                    const prediction = await window.mlService.predict('biodiversity_predictor', {
                        latitude: center.lat,
                        longitude: center.lng,
                        temperature: 25.0,
                        depth: 20.0
                    });
                    
                    mlDemo.log(`‚úÖ Predi√ß√£o realizada: ${JSON.stringify(prediction.prediction)}`);
                    mlDemo.log(`üéØ Confian√ßa: ${(prediction.confidence * 100).toFixed(1)}%`);
                    
                } catch (error) {
                    mlDemo.log(`‚ùå Erro na predi√ß√£o: ${error.message}`);
                }
            } else {
                mlDemo.log('‚ö†Ô∏è MLService n√£o dispon√≠vel');
            }
        }

        async function showMLStats() {
            mlDemo.log('üìä Obtendo estat√≠sticas ML...');
            
            if (window.mlService) {
                try {
                    const stats = await window.mlService.getStats();
                    mlDemo.log(`üìà Estat√≠sticas: ${JSON.stringify(stats, null, 2)}`);
                } catch (error) {
                    mlDemo.log(`‚ùå Erro obtendo stats: ${error.message}`);
                }
            }
            
            mlDemo.updateStats();
        }

        function clearDemoData() {
            mlDemo.log('üßπ Limpando dados de demonstra√ß√£o...');
            
            if (window.mlService) {
                window.mlService.clearCache();
                mlDemo.log('‚úÖ Cache limpo');
            }
            
            // Limpar log (manter √∫ltimas 5 linhas)
            const logLines = mlDemo.logContainer.children;
            while (logLines.length > 5) {
                mlDemo.logContainer.removeChild(logLines[0]);
            }
            
            mlDemo.log('üßπ Limpeza conclu√≠da');
        }

        // Inicializar demo quando p√°gina carregar
        let mlDemo;
        
        document.addEventListener('DOMContentLoaded', () => {
            mlDemo = new MLDemo();
            mlDemo.initialize();
        });
    </script>
</body>
</html>
